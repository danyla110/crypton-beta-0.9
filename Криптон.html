<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–∏–ø—Ç–æ–Ω</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            margin-bottom: 25px;
            transition: transform 0.2s ease;
        }
        .container:hover {
            transform: translateY(-2px);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        textarea, input[type="text"], input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        textarea:focus, input[type="text"]:focus, input[type="file"]:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: monospace;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            font-weight: 600;
        }
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-danger {
            background-color: #e74c3c;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-success {
            background-color: #2ecc71;
        }
        .btn-success:hover {
            background-color: #27ae60;
        }
        .btn-secondary {
            background-color: #95a5a6;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            word-break: break-all;
            font-family: monospace;
            min-height: 60px;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        .copy-btn:hover {
            background: #f8f9fa;
        }
        .key-info {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .action-buttons {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .key-display {
            font-family: monospace;
            font-size: 12px;
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            overflow-x: auto;
            white-space: pre-wrap;
            border: 1px solid #e9ecef;
            max-height: 150px;
            overflow-y: auto;
        }
        .message {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ready {
            background-color: #2ecc71;
        }
        .status-not-ready {
            background-color: #e74c3c;
        }
        .key-status {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .key-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .input-with-button {
            display: flex;
            gap: 10px;
        }
        .input-with-button textarea {
            flex: 1;
        }
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .btn:disabled:hover {
            background-color: #bdc3c7;
            transform: none;
            box-shadow: none;
        }
        .example-text {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
            font-style: italic;
        }
        .auto-copy {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .auto-copy input {
            margin-right: 8px;
        }
        .file-input-container {
            margin: 15px 0;
        }
        .file-info {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>üîê –ö—Ä–∏–ø—Ç–æ–Ω. RSA –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h1>
    
    <div class="container">
        <h2>üóùÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏</h2>
        <div class="key-status">
            <span id="keyStatusIndicator" class="status-indicator status-not-ready"></span>
            <span id="keyStatusText">–ö–ª—é—á–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</span>
        </div>
        
        <div class="action-buttons">
            <button id="generateKeys" class="btn">
                <span class="loader" id="generateLoader" style="display: none;"></span>
                –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–ª—é—á–∏
            </button>
            <button id="loadKeys" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª—é—á–∏ –∏–∑ —Ñ–∞–π–ª–∞</button>
            <button id="loadFromStorage" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</button>
            <button id="clearKeys" class="btn btn-danger">–û—á–∏—Å—Ç–∏—Ç—å –∫–ª—é—á–∏</button>
            <button id="exportKeys" class="btn btn-secondary">–≠–∫—Å–ø–æ—Ä—Ç –∫–ª—é—á–µ–π</button>
        </div>
        
        <div class="file-input-container" id="fileInputContainer" style="display: none;">
            <label for="keyFileInput">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏ (JSON):</label>
            <input type="file" id="keyFileInput" accept=".json,application/json">
            <div class="file-info">–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
        </div>
        
        <div class="form-group">
            <label>üîë –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á:</label>
            <div id="privateKeyDisplay" class="key-display">–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>
            <button class="copy-btn" data-target="privateKeyDisplay">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        
        <div class="form-group">
            <label>üîì –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:</label>
            <div id="publicKeyDisplay" class="key-display">–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>
            <button class="copy-btn" data-target="publicKeyDisplay">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
    
    <div class="container">
        <h2>üîí –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
        <div class="form-group">
            <label for="messageToEncrypt">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
            <textarea id="messageToEncrypt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è..."></textarea>
            <div class="example-text">–ü—Ä–∏–º–µ—Ä: –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</div>
        </div>
        
        <div class="auto-copy">
            <input type="checkbox" id="autoCopyEncrypted" checked>
            <label for="autoCopyEncrypted">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–æ–ª–µ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
        </div>
        
        <button id="encryptBtn" class="btn btn-success">
            <span class="loader" id="encryptLoader" style="display: none;"></span>
            –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
        </button>
        
        <div class="form-group">
            <label>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (hex):</label>
            <div id="encryptedResult" class="result">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
            <button class="copy-btn" data-target="encryptedResult">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
    
    <div class="container">
        <h2>üîì –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
        <div class="form-group">
            <label for="messageToDecrypt">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (hex):</label>
            <textarea id="messageToDecrypt" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ hex-—Ñ–æ—Ä–º–∞—Ç–µ..."></textarea>
            <div class="example-text">–ü—Ä–∏–º–µ—Ä: 4a8f1e... (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å hex-—Å–∏–º–≤–æ–ª–æ–≤)</div>
        </div>
        
        <button id="decryptBtn" class="btn btn-success">
            <span class="loader" id="decryptLoader" style="display: none;"></span>
            –î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
        </button>
        
        <div class="form-group">
            <label>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
            <div id="decryptedResult" class="result">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
            <button class="copy-btn" data-target="decryptedResult">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
    
    <div class="container">
        <h2>üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</h2>
        <ul>
            <li>–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–ª—é—á–∏</li>
            <li>–î–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á</li>
            <li>–î–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á</li>
            <li>–ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</li>
            <li>–ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥—Ä—É–≥–∏–º –ª–∏—Ü–∞–º</li>
            <li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</li>
        </ul>
    </div>
    
    <div id="messageArea"></div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π
        let cryptoKeys = null;
        let autoCopyEnabled = true;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const generateKeysBtn = document.getElementById('generateKeys');
        const loadKeysBtn = document.getElementById('loadKeys');
        const loadFromStorageBtn = document.getElementById('loadFromStorage');
        const clearKeysBtn = document.getElementById('clearKeys');
        const exportKeysBtn = document.getElementById('exportKeys');
        const encryptBtn = document.getElementById('encryptBtn');
        const decryptBtn = document.getElementById('decryptBtn');
        const messageToEncrypt = document.getElementById('messageToEncrypt');
        const messageToDecrypt = document.getElementById('messageToDecrypt');
        const encryptedResult = document.getElementById('encryptedResult');
        const decryptedResult = document.getElementById('decryptedResult');
        const privateKeyDisplay = document.getElementById('privateKeyDisplay');
        const publicKeyDisplay = document.getElementById('publicKeyDisplay');
        const messageArea = document.getElementById('messageArea');
        const keyStatusIndicator = document.getElementById('keyStatusIndicator');
        const keyStatusText = document.getElementById('keyStatusText');
        const generateLoader = document.getElementById('generateLoader');
        const encryptLoader = document.getElementById('encryptLoader');
        const decryptLoader = document.getElementById('decryptLoader');
        const autoCopyCheckbox = document.getElementById('autoCopyEncrypted');
        const fileInputContainer = document.getElementById('fileInputContainer');
        const keyFileInput = document.getElementById('keyFileInput');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            loadFromStorage(); // –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª—é—á–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setupEventListeners();
            updateUI();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            generateKeysBtn.addEventListener('click', generateKeys);
            loadKeysBtn.addEventListener('click', showFileInput);
            loadFromStorageBtn.addEventListener('click', loadFromStorage);
            clearKeysBtn.addEventListener('click', clearKeys);
            exportKeysBtn.addEventListener('click', exportKeys);
            encryptBtn.addEventListener('click', encryptMessage);
            decryptBtn.addEventListener('click', decryptMessage);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            keyFileInput.addEventListener('change', handleFileSelect);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
            autoCopyCheckbox.addEventListener('change', (e) => {
                autoCopyEnabled = e.target.checked;
            });
            
            // –ö–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const targetElement = document.getElementById(targetId);
                    copyToClipboard(targetElement.textContent);
                    showMessage('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                });
            });
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è hex-–≤–≤–æ–¥–∞
            messageToDecrypt.addEventListener('input', function() {
                const value = this.value.trim();
                if (value && !/^[0-9a-fA-F]+$/.test(value)) {
                    this.style.borderColor = '#e74c3c';
                    showMessage('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π hex-—Ñ–æ—Ä–º–∞—Ç (—Ç–æ–ª—å–∫–æ 0-9, a-f, A-F)', 'warning');
                } else {
                    this.style.borderColor = '#e1e8ed';
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
            messageToEncrypt.addEventListener('input', debounce(saveTextState, 500));
            messageToDecrypt.addEventListener('input', debounce(saveTextState, 500));
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        function showFileInput() {
            fileInputContainer.style.display = 'block';
            keyFileInput.value = ''; // –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤—ã–±–æ—Ä
            showMessage('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON', 'warning');
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = async (e) => {
                try {
                    const fileContent = e.target.result;
                    const keysData = JSON.parse(fileContent);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞
                    if (!keysData.privateKey || !keysData.publicKey) {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á–∏.');
                    }
                    
                    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª—é—á–∏
                    await importKeysFromData(keysData.privateKey, keysData.publicKey);
                    fileInputContainer.style.display = 'none';
                    showMessage('‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π –∏–∑ —Ñ–∞–π–ª–∞:', error);
                    showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π –∏–∑ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
                }
            };
            
            reader.onerror = () => {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // –ò–º–ø–æ—Ä—Ç –∫–ª—é—á–µ–π –∏–∑ –¥–∞–Ω–Ω—ã—Ö
        async function importKeysFromData(privateKeyBase64, publicKeyBase64) {
            try {
                const privateKeyData = base64ToArrayBuffer(privateKeyBase64);
                const publicKeyData = base64ToArrayBuffer(publicKeyBase64);
                
                cryptoKeys = {
                    privateKey: await window.crypto.subtle.importKey(
                        "pkcs8",
                        privateKeyData,
                        {
                            name: "RSA-OAEP",
                            hash: "SHA-256"
                        },
                        true,
                        ["decrypt"]
                    ),
                    publicKey: await window.crypto.subtle.importKey(
                        "spki",
                        publicKeyData,
                        {
                            name: "RSA-OAEP",
                            hash: "SHA-256"
                        },
                        true,
                        ["encrypt"]
                    )
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                await saveKeys();
                await updateKeyDisplay();
                updateUI();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∫–ª—é—á–µ–π:', error);
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.');
            }
        }
        
        // Debounce –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
        function saveTextState() {
            const state = {
                messageToEncrypt: messageToEncrypt.value,
                messageToDecrypt: messageToDecrypt.value
            };
            localStorage.setItem('rsaTextState', JSON.stringify(state));
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
        function loadTextState() {
            try {
                const state = JSON.parse(localStorage.getItem('rsaTextState'));
                if (state) {
                    messageToEncrypt.value = state.messageToEncrypt || '';
                    messageToDecrypt.value = state.messageToDecrypt || '';
                }
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞:', e);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function updateUI() {
            const hasKeys = cryptoKeys !== null;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª—é—á–µ–π
            if (hasKeys) {
                keyStatusIndicator.className = 'status-indicator status-ready';
                keyStatusText.textContent = '–ö–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é';
                keyStatusText.style.color = '#27ae60';
            } else {
                keyStatusIndicator.className = 'status-indicator status-not-ready';
                keyStatusText.textContent = '–ö–ª—é—á–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                keyStatusText.style.color = '#e74c3c';
            }
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫
            encryptBtn.disabled = !hasKeys;
            decryptBtn.disabled = !hasKeys;
            exportKeysBtn.disabled = !hasKeys;
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            encryptBtn.title = hasKeys ? '' : '–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏';
            decryptBtn.title = hasKeys ? '' : '–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messageArea.appendChild(messageDiv);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.style.opacity = '0';
                    messageDiv.style.transition = 'opacity 0.3s';
                    setTimeout(() => {
                        if (messageDiv.parentNode) {
                            messageDiv.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).catch(() => {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
        async function generateKeys() {
            try {
                generateLoader.style.display = 'inline-block';
                generateKeysBtn.disabled = true;
                
                cryptoKeys = await window.crypto.subtle.generateKey(
                    {
                        name: "RSA-OAEP",
                        modulusLength: 2048,
                        publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                        hash: "SHA-256"
                    },
                    true,
                    ["encrypt", "decrypt"]
                );
                
                await saveKeys();
                await updateKeyDisplay();
                updateUI();
                
                showMessage('‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π: ' + error.message, 'error');
            } finally {
                generateLoader.style.display = 'none';
                generateKeysBtn.disabled = false;
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        async function saveKeys() {
            if (!cryptoKeys) return;
            
            try {
                const privateKeyData = await window.crypto.subtle.exportKey("pkcs8", cryptoKeys.privateKey);
                const publicKeyData = await window.crypto.subtle.exportKey("spki", cryptoKeys.publicKey);
                
                const privateKeyBase64 = arrayBufferToBase64(privateKeyData);
                const publicKeyBase64 = arrayBufferToBase64(publicKeyData);
                
                localStorage.setItem('rsaPrivateKey', privateKeyBase64);
                localStorage.setItem('rsaPublicKey', publicKeyBase64);
                
                console.log('–ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–ª—é—á–µ–π:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–ª—é—á–µ–π: ' + error.message, 'error');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–µ–π –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        async function loadFromStorage() {
            try {
                const privateKeyBase64 = localStorage.getItem('rsaPrivateKey');
                const publicKeyBase64 = localStorage.getItem('rsaPublicKey');
                
                if (!privateKeyBase64 || !publicKeyBase64) {
                    showMessage('‚ÑπÔ∏è –ö–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏—Ö.', 'warning');
                    loadTextState(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—Å—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª—é—á–µ–π –Ω–µ—Ç
                    return;
                }
                
                await importKeysFromData(privateKeyBase64, publicKeyBase64);
                showMessage('‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π: ' + error.message, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª—é—á–µ–π
        async function updateKeyDisplay() {
            if (!cryptoKeys) return;
            
            try {
                const privateKeyData = await window.crypto.subtle.exportKey("pkcs8", cryptoKeys.privateKey);
                const publicKeyData = await window.crypto.subtle.exportKey("spki", cryptoKeys.publicKey);
                
                const privateKeyBase64 = arrayBufferToBase64(privateKeyData);
                const publicKeyBase64 = arrayBufferToBase64(publicKeyData);
                
                privateKeyDisplay.textContent = formatKey(privateKeyBase64);
                publicKeyDisplay.textContent = formatKey(publicKeyBase64);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª—é—á–µ–π:', error);
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function formatKey(keyBase64) {
            return keyBase64.match(/.{1,64}/g).join('\n');
        }
        
        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        async function encryptMessage() {
            if (!cryptoKeys) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏', 'error');
                return;
            }
            
            const message = messageToEncrypt.value.trim();
            if (!message) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', 'error');
                messageToEncrypt.focus();
                return;
            }
            
            try {
                encryptLoader.style.display = 'inline-block';
                encryptBtn.disabled = true;
                
                const encoder = new TextEncoder();
                const data = encoder.encode(message);
                
                const encrypted = await window.crypto.subtle.encrypt(
                    { name: "RSA-OAEP" },
                    cryptoKeys.publicKey,
                    data
                );
                
                const hexString = arrayBufferToHexString(encrypted);
                encryptedResult.textContent = hexString;
                
                if (autoCopyEnabled) {
                    messageToDecrypt.value = hexString;
                    saveTextState();
                }
                
                showMessage('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏: ' + error.message, 'error');
            } finally {
                encryptLoader.style.display = 'none';
                encryptBtn.disabled = false;
            }
        }
        
        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        async function decryptMessage() {
            if (!cryptoKeys) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏', 'error');
                return;
            }
            
            const encryptedHex = messageToDecrypt.value.trim();
            if (!encryptedHex) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
                messageToDecrypt.focus();
                return;
            }
            
            if (!/^[0-9a-fA-F]+$/.test(encryptedHex)) {
                showMessage('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ hex-—Å–∏–º–≤–æ–ª—ã (0-9, a-f, A-F)', 'error');
                messageToDecrypt.focus();
                return;
            }
            
            try {
                decryptLoader.style.display = 'inline-block';
                decryptBtn.disabled = true;
                
                const encryptedData = hexStringToArrayBuffer(encryptedHex);
                
                const decrypted = await window.crypto.subtle.decrypt(
                    { name: "RSA-OAEP" },
                    cryptoKeys.privateKey,
                    encryptedData
                );
                
                const decoder = new TextDecoder();
                const decryptedMessage = decoder.decode(decrypted);
                decryptedResult.textContent = decryptedMessage;
                
                showMessage('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏: ' + error.message, 'error');
            } finally {
                decryptLoader.style.display = 'none';
                decryptBtn.disabled = false;
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –∫–ª—é—á–µ–π
        async function exportKeys() {
            if (!cryptoKeys) {
                showMessage('‚ùå –ù–µ—Ç –∫–ª—é—á–µ–π –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            
            try {
                const privateKeyData = await window.crypto.subtle.exportKey("pkcs8", cryptoKeys.privateKey);
                const publicKeyData = await window.crypto.subtle.exportKey("spki", cryptoKeys.publicKey);
                
                const privateKeyBase64 = arrayBufferToBase64(privateKeyData);
                const publicKeyBase64 = arrayBufferToBase64(publicKeyData);
                
                const exportData = {
                    privateKey: privateKeyBase64,
                    publicKey: publicKeyBase64,
                    timestamp: new Date().toISOString(),
                    format: 'RSA-OAEP 2048'
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `rsa-keys-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showMessage('‚úÖ –ö–ª—é—á–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∫–ª—é—á–µ–π:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∫–ª—é—á–µ–π: ' + error.message, 'error');
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∫–ª—é—á–µ–π
        function clearKeys() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }
            
            cryptoKeys = null;
            localStorage.removeItem('rsaPrivateKey');
            localStorage.removeItem('rsaPublicKey');
            localStorage.removeItem('rsaTextState');
            
            privateKeyDisplay.textContent = '–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
            publicKeyDisplay.textContent = '–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
            messageToEncrypt.value = '';
            messageToDecrypt.value = '';
            encryptedResult.textContent = '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è';
            decryptedResult.textContent = '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è';
            fileInputContainer.style.display = 'none';
            
            updateUI();
            showMessage('üóëÔ∏è –í—Å–µ –∫–ª—é—á–∏ –∏ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
        function arrayBufferToBase64(buffer) {
            const bytes = new Uint8Array(buffer);
            let binary = '';
            for (let i = 0; i < bytes.byteLength; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }
        
        function base64ToArrayBuffer(base64) {
            const binary = atob(base64);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) {
                bytes[i] = binary.charCodeAt(i);
            }
            return bytes.buffer;
        }
        
        function arrayBufferToHexString(buffer) {
            const bytes = new Uint8Array(buffer);
            let hex = '';
            for (let i = 0; i < bytes.length; i++) {
                const hexByte = bytes[i].toString(16).padStart(2, '0');
                hex += hexByte;
            }
            return hex;
        }
        
        function hexStringToArrayBuffer(hexString) {
            const bytes = new Uint8Array(hexString.length / 2);
            for (let i = 0; i < hexString.length; i += 2) {
                bytes[i / 2] = parseInt(hexString.substr(i, 2), 16);
            }
            return bytes.buffer;
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.addEventListener('load', init);
    </script>
</body>
</html>