<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <title>–ö—Ä–∏–ø—Ç–æ–Ω</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        html {
            overflow-x: hidden;
        }
        body {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            padding-left: max(20px, env(safe-area-inset-left));
            padding-right: max(20px, env(safe-area-inset-right));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(1.25rem, 5vw, 1.75rem);
            padding-top: env(safe-area-inset-top, 0);
        }
        .container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            margin-bottom: 25px;
            transition: transform 0.2s ease;
        }
        @media (hover: hover) {
            .container:hover {
                transform: translateY(-2px);
            }
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        textarea, input[type="text"], input[type="file"] {
            width: 100%;
            padding: 14px 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px; /* 16px –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑—É–º –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ iOS */
            transition: border-color 0.3s;
            -webkit-appearance: none;
            touch-action: manipulation;
        }
        textarea:focus, input[type="text"]:focus, input[type="file"]:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: monospace;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 14px 20px;
            min-height: 48px;
            min-width: 48px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            font-weight: 600;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        @media (hover: hover) {
            .btn:hover {
                background-color: #2980b9;
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            }
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-danger {
            background-color: #e74c3c;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-success {
            background-color: #2ecc71;
        }
        .btn-success:hover {
            background-color: #27ae60;
        }
        .btn-secondary {
            background-color: #95a5a6;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        .result-wrapper, .key-display-wrapper {
            position: relative;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            word-break: break-all;
            font-family: monospace;
            font-size: 13px;
            min-height: 60px;
            max-height: 200px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        /* –ö–Ω–æ–ø–∫–∞ ¬´–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å¬ª ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è, –≤ —Å—Ç—Ä–æ–∫–µ —Å –ø–æ–¥–ø–∏—Å—å—é */
        .copy-btn {
            display: none;
            background: rgba(255,255,255,0.95);
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 11px;
            min-height: 28px;
            min-width: 28px;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        .result-wrapper.has-data .result {
            padding: 15px;
        }
        .result-wrapper.has-data .copy-btn {
            display: inline-block;
        }
        .label-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 8px;
        }
        .label-row label {
            margin-bottom: 0;
        }
        .key-display-wrapper.has-data .label-row .copy-btn {
            display: inline-block;
        }
        @media (hover: hover) {
            .copy-btn:hover {
                background: #f8f9fa;
            }
        }
        .key-info {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .action-buttons {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .action-buttons .btn {
            flex: 1 1 auto;
            min-width: 140px;
        }
        .key-display {
            font-family: monospace;
            font-size: 12px;
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-top: 0;
            overflow-x: auto;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #e9ecef;
            max-height: 150px;
            -webkit-overflow-scrolling: touch;
        }
        .message {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ready {
            background-color: #2ecc71;
        }
        .status-not-ready {
            background-color: #e74c3c;
        }
        .key-status {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .key-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .input-with-button {
            display: flex;
            gap: 10px;
        }
        .input-with-button textarea {
            flex: 1;
        }
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            pointer-events: none;
        }
        .btn:disabled:hover,
        .btn:disabled:active {
            background-color: #bdc3c7;
            transform: none;
            box-shadow: none;
        }
        .example-text {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
            font-style: italic;
        }
        .auto-copy {
            display: flex;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }
        .auto-copy input[type="checkbox"] {
            min-width: 28px;
            min-height: 28px;
            margin: 0;
            cursor: pointer;
        }
        .auto-copy label {
            cursor: pointer;
            padding: 10px 0;
            min-height: 48px;
            display: flex;
            align-items: center;
        }
        .file-input-container,
        .paste-keys-container {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .file-input-container label {
            display: block;
            padding: 12px 0;
            min-height: 48px;
        }
        .file-input-container input[type="file"] {
            min-height: 48px;
            padding: 12px;
        }
        .paste-keys-container textarea {
            min-height: 80px;
        }
        .file-info {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 480px) {
            body {
                padding: 12px;
            }
            .container {
                padding: 16px;
            }
            .action-buttons .btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <noscript><div style="padding:20px;margin:20px;background:#f8d7da;border:1px solid #f5c6cb;border-radius:8px;">–î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–∫–ª—é—á–∏—Ç–µ JavaScript –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ Chrome / Edge / Firefox (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ —Ñ–∞–π–ª—É).</div></noscript>
    <h1>üîê –ö—Ä–∏–ø—Ç–æ–Ω. RSA –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h1>
    
    <div class="container">
        <h2>üóùÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏</h2>
        <div class="key-status">
            <span id="keyStatusIndicator" class="status-indicator status-not-ready"></span>
            <span id="keyStatusText">–ö–ª—é—á–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</span>
        </div>
        
        <div class="action-buttons">
            <button type="button" id="generateKeys" class="btn" onclick="window.CryptonRun('generateKeys'); return false;">
                <span class="loader" id="generateLoader" style="display: none;"></span>
                –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–ª—é—á–∏
            </button>
            <button type="button" id="loadKeys" class="btn" onclick="window.CryptonRun('loadKeys'); return false;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª—é—á–∏ –∏–∑ —Ñ–∞–π–ª–∞</button>
            <button type="button" id="pasteKeys" class="btn" onclick="window.CryptonRun('pasteKeys'); return false;">–í—Å—Ç–∞–≤–∏—Ç—å –∫–ª—é—á–∏ –≤—Ä—É—á–Ω—É—é</button>
            <button type="button" id="clearKeys" class="btn btn-danger" onclick="window.CryptonRun('clearKeys'); return false;">–û—á–∏—Å—Ç–∏—Ç—å –∫–ª—é—á–∏</button>
            <button type="button" id="exportKeys" class="btn btn-secondary" onclick="window.CryptonRun('exportKeys'); return false;">–≠–∫—Å–ø–æ—Ä—Ç –∫–ª—é—á–µ–π</button>
        </div>
        
        <div class="file-input-container" id="fileInputContainer" style="display: none;">
            <label for="keyFileInput">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏ (JSON):</label>
            <input type="file" id="keyFileInput" accept=".json,application/json" onchange="window.CryptonRun('fileSelect', this);">
            <div class="file-info">–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
        </div>
        
        <div class="paste-keys-container" id="pasteKeysContainer" style="display: none;">
            <p class="file-info">–í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64 (PKCS8 –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ, SPKI –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ):</p>
            <div class="form-group">
                <label for="pastePrivateKey">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (Base64):</label>
                <textarea id="pastePrivateKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64..." rows="4"></textarea>
            </div>
            <div class="form-group">
                <label for="pastePublicKey">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (Base64):</label>
                <textarea id="pastePublicKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64..." rows="4"></textarea>
            </div>
            <button type="button" id="applyPastedKeys" class="btn btn-success" onclick="window.CryptonRun('applyPastedKeys'); return false;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–ª—é—á–∏</button>
            <button type="button" id="cancelPasteKeys" class="btn btn-secondary" onclick="window.CryptonRun('cancelPasteKeys'); return false;">–û—Ç–º–µ–Ω–∞</button>
        </div>
        
        <div class="form-group">
            <div class="key-display-wrapper">
                <div class="label-row">
                    <label>üîë –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á:</label>
                    <button type="button" class="copy-btn" data-target="privateKeyDisplay" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á" onclick="window.CryptonRun('copy','privateKeyDisplay'); return false;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div id="privateKeyDisplay" class="key-display">–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>
            </div>
        </div>
        
        <div class="form-group">
            <div class="key-display-wrapper">
                <div class="label-row">
                    <label>üîì –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:</label>
                    <button type="button" class="copy-btn" data-target="publicKeyDisplay" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á" onclick="window.CryptonRun('copy','publicKeyDisplay'); return false;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div id="publicKeyDisplay" class="key-display">–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>üîí –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
        <div class="form-group">
            <label for="messageToEncrypt">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
            <textarea id="messageToEncrypt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è..." inputmode="text"></textarea>
            <div class="example-text">–ü—Ä–∏–º–µ—Ä: –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</div>
        </div>
        
        <div class="auto-copy">
            <input type="checkbox" id="autoCopyEncrypted" checked onchange="window.autoCopyEnabled=this.checked;">
            <label for="autoCopyEncrypted">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–æ–ª–µ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
        </div>
        
        <button type="button" id="encryptBtn" class="btn btn-success" onclick="window.CryptonRun('encrypt'); return false;">
            <span class="loader" id="encryptLoader" style="display: none;"></span>
            –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
        </button>
        
        <div class="form-group">
            <div class="result-wrapper">
                <div class="label-row">
                    <label>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (hex):</label>
                    <button type="button" class="copy-btn" data-target="encryptedResult" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç" onclick="window.CryptonRun('copy','encryptedResult'); return false;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div id="encryptedResult" class="result">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>üîì –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
        <div class="form-group">
            <label for="messageToDecrypt">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (hex):</label>
            <textarea id="messageToDecrypt" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ hex-—Ñ–æ—Ä–º–∞—Ç–µ..." inputmode="text" autocomplete="off"></textarea>
            <div class="example-text">–ü—Ä–∏–º–µ—Ä: 4a8f1e... –∏–ª–∏ h1... –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ (hex)</div>
        </div>
        
        <button type="button" id="decryptBtn" class="btn btn-success" onclick="window.CryptonRun('decrypt'); return false;">
            <span class="loader" id="decryptLoader" style="display: none;"></span>
            –î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å
        </button>
        
        <div class="form-group">
            <div class="result-wrapper">
                <div class="label-row">
                    <label>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <button type="button" class="copy-btn" data-target="decryptedResult" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç" onclick="window.CryptonRun('copy','decryptedResult'); return false;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div id="decryptedResult" class="result">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</h2>
        <ul>
            <li>–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á–∏ –≤—Ä—É—á–Ω—É—é</li>
            <li>–î–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á</li>
            <li>–î–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á</li>
            <li>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: –¥–æ 10 –ú–ë (–≥–∏–±—Ä–∏–¥–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ AES + RSA)</li>
            <li>–ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</li>
            <li>–ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥—Ä—É–≥–∏–º –ª–∏—Ü–∞–º</li>
            <li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</li>
        </ul>
    </div>
    
    <div id="messageArea"></div>

    <script>
        // –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ —Å—Ä–µ–¥—Å—Ç–≤–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ HTML)
        window.CryptonRun = function(action, arg) {
            if (window.CryptonHandlers && window.CryptonHandlers[action]) {
                try { window.CryptonHandlers[action](arg); } catch (e) { alert('–û—à–∏–±–∫–∞: ' + (e.message || e)); }
            }
        };
        window.CryptonHandlers = {};

        var cryptoKeys = null;
        var autoCopyEnabled = true;
        window.autoCopyEnabled = true;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM (–ø–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è CryptonRun)
        var generateKeysBtn = document.getElementById('generateKeys');
        var loadKeysBtn = document.getElementById('loadKeys');
        var clearKeysBtn = document.getElementById('clearKeys');
        var exportKeysBtn = document.getElementById('exportKeys');
        var encryptBtn = document.getElementById('encryptBtn');
        var decryptBtn = document.getElementById('decryptBtn');
        var messageToEncrypt = document.getElementById('messageToEncrypt');
        var messageToDecrypt = document.getElementById('messageToDecrypt');
        var encryptedResult = document.getElementById('encryptedResult');
        var decryptedResult = document.getElementById('decryptedResult');
        var privateKeyDisplay = document.getElementById('privateKeyDisplay');
        var publicKeyDisplay = document.getElementById('publicKeyDisplay');
        var messageArea = document.getElementById('messageArea');
        var keyStatusIndicator = document.getElementById('keyStatusIndicator');
        var keyStatusText = document.getElementById('keyStatusText');
        var generateLoader = document.getElementById('generateLoader');
        var encryptLoader = document.getElementById('encryptLoader');
        var decryptLoader = document.getElementById('decryptLoader');
        var autoCopyCheckbox = document.getElementById('autoCopyEncrypted');
        var fileInputContainer = document.getElementById('fileInputContainer');
        var keyFileInput = document.getElementById('keyFileInput');
        var pasteKeysBtn = document.getElementById('pasteKeys');
        var pasteKeysContainer = document.getElementById('pasteKeysContainer');
        var pastePrivateKeyInput = document.getElementById('pastePrivateKey');
        var pastePublicKeyInput = document.getElementById('pastePublicKey');
        var applyPastedKeysBtn = document.getElementById('applyPastedKeys');
        var cancelPasteKeysBtn = document.getElementById('cancelPasteKeys');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            try {
                if (!messageArea) {
                    document.body.innerHTML = '<p style="padding:20px;color:red;">–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π.</p>';
                    return;
                }
                window.CryptonHandlers = {
                    generateKeys: generateKeys,
                    loadKeys: showFileInput,
                    pasteKeys: showPasteKeysInput,
                    clearKeys: clearKeys,
                    exportKeys: exportKeys,
                    applyPastedKeys: applyPastedKeys,
                    cancelPasteKeys: hidePasteKeysInput,
                    encrypt: encryptMessage,
                    decrypt: decryptMessage,
                    fileSelect: function(inputEl) { handleFileSelect({ target: inputEl }); },
                    copy: function(targetId) {
                        var el = document.getElementById(targetId);
                        if (!el) return;
                        var text = (el.textContent || '').trim();
                        if (!text || text.indexOf('–ó–¥–µ—Å—å –±—É–¥–µ—Ç') === 0 || text === '–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω') {
                            showMessage('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                            return;
                        }
                        copyToClipboard(text);
                        showMessage('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                    }
                };
                if (typeof document.addEventListener === 'function') setupEventListeners();
                loadTextState();
                if (!window.crypto || !window.crypto.subtle) {
                    showMessage('‚ùå Web Crypto API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Chrome, Edge) –∏–ª–∏ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost.', 'error');
                    updateUI();
                    return;
                }
                if (typeof Promise !== 'undefined') {
                    loadFromStorage(true).then(function() { updateUI(); }).catch(function(e) { showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª—é—á–µ–π: ' + (e && e.message ? e.message : e), 'error'); updateUI(); });
                } else {
                    updateUI();
                }
                updateUI();
            } catch (err) {
                if (messageArea) {
                    var div = document.createElement('div');
                    div.className = 'message error';
                    div.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + (err.message ? err.message : String(err));
                    messageArea.appendChild(div);
                }
            }
        }
        
        function bindButton(el, handler) {
            if (!el || typeof handler !== 'function') return;
            if (typeof el.addEventListener !== 'function') return;
            var lastTap = 0;
            function run(e) {
                if (e && e.type === 'touchend') e.preventDefault();
                var now = Date.now();
                if (now - lastTap < 350) return;
                lastTap = now;
                handler(e);
            }
            el.addEventListener('click', run);
            try { el.addEventListener('touchend', run, { passive: false }); } catch (err) { }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –í—Å–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ onclick -> CryptonRun() –≤ HTML,
        // —á—Ç–æ–±—ã –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–≤–∞–∂–¥—ã (—Ä–∞–Ω—å—à–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –∏ onclick, –∏ addEventListener).
        function setupEventListeners() {
            try {
                if (typeof document.addEventListener !== 'function') return;
                if (messageToDecrypt && messageToDecrypt.addEventListener) {
                    messageToDecrypt.addEventListener('input', function() {
                        var value = (this.value || '').trim();
                        if (!value) { this.style.borderColor = '#e1e8ed'; return; }
                        var hexPart = value.indexOf('h1') === 0 ? value.slice(2) : value;
                        if (!/^(h1)?[0-9a-fA-F]*$/.test(value)) { this.style.borderColor = '#e74c3c'; return; }
                        if (hexPart.length % 2 !== 0) { this.style.borderColor = '#f39c12'; return; }
                        this.style.borderColor = '#e1e8ed';
                    });
                }
                if (messageToEncrypt && messageToEncrypt.addEventListener) messageToEncrypt.addEventListener('input', debounce(saveTextState, 500));
                if (messageToDecrypt && messageToDecrypt.addEventListener) messageToDecrypt.addEventListener('input', debounce(saveTextState, 500));
            } catch (err) { }
        }
        
        function showFileInput() {
            if (pasteKeysContainer) pasteKeysContainer.style.display = 'none';
            if (fileInputContainer) fileInputContainer.style.display = 'block';
            if (keyFileInput) keyFileInput.value = '';
            showMessage('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON', 'warning');
        }
        function showPasteKeysInput() {
            if (fileInputContainer) fileInputContainer.style.display = 'none';
            if (pasteKeysContainer) pasteKeysContainer.style.display = 'block';
            if (pastePrivateKeyInput) pastePrivateKeyInput.value = '';
            if (pastePublicKeyInput) pastePublicKeyInput.value = '';
            setTimeout(function() {
                if (pastePrivateKeyInput) { pastePrivateKeyInput.focus(); if (pastePrivateKeyInput.scrollIntoView) pastePrivateKeyInput.scrollIntoView({ behavior: 'auto', block: 'center' }); }
            }, 150);
        }
        function hidePasteKeysInput() {
            if (pasteKeysContainer) pasteKeysContainer.style.display = 'none';
            if (pastePrivateKeyInput) pastePrivateKeyInput.value = '';
            if (pastePublicKeyInput) pastePublicKeyInput.value = '';
        }
        
        function applyPastedKeys() {
            if (applyPastedKeysBtn && applyPastedKeysBtn.disabled) return;
            var privateKeyBase64 = pastePrivateKeyInput ? pastePrivateKeyInput.value.trim() : '';
            var publicKeyBase64 = pastePublicKeyInput ? pastePublicKeyInput.value.trim() : '';
            if (!privateKeyBase64 || !publicKeyBase64) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –æ–±–∞ –∫–ª—é—á–∞ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π)', 'error');
                return;
            }
            if (applyPastedKeysBtn) applyPastedKeysBtn.disabled = true;
            importKeysFromData(privateKeyBase64, publicKeyBase64).then(function() {
                hidePasteKeysInput();
                showMessage('‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            }).catch(function(error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∫–ª—é—á–µ–π: ' + (error && error.message ? error.message : error), 'error');
            }).then(function() {
                if (applyPastedKeysBtn) applyPastedKeysBtn.disabled = false;
            });
        }
        function handleFileSelect(event) {
            var target = event && event.target ? event.target : (keyFileInput || null);
            var file = target && target.files && target.files[0] ? target.files[0] : null;
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var fileContent = e.target.result;
                    var keysData = JSON.parse(fileContent);
                    if (!keysData.privateKey || !keysData.publicKey) {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á–∏.');
                    }
                    importKeysFromData(keysData.privateKey, keysData.publicKey).then(function() {
                        if (fileInputContainer) fileInputContainer.style.display = 'none';
                        if (pasteKeysContainer) pasteKeysContainer.style.display = 'none';
                        showMessage('‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞');
                    }).catch(function(error) {
                        showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π –∏–∑ —Ñ–∞–π–ª–∞: ' + (error && error.message ? error.message : error), 'error');
                        if (keyFileInput) keyFileInput.value = '';
                    });
                } catch (err) {
                    showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π –∏–∑ —Ñ–∞–π–ª–∞: ' + (err && err.message ? err.message : err), 'error');
                    if (keyFileInput) keyFileInput.value = '';
                }
            };
            reader.onerror = function() {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', 'error');
                if (keyFileInput) keyFileInput.value = '';
            };
            reader.readAsText(file);
        }
        function importKeysFromData(privateKeyBase64, publicKeyBase64) {
            var cleanPrivate = (privateKeyBase64 || '').replace(/\s/g, '');
            var cleanPublic = (publicKeyBase64 || '').replace(/\s/g, '');
            if (!cleanPrivate || !cleanPublic) return Promise.reject(new Error('–ö–ª—é—á–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏.'));
            var privateKeyData = base64ToArrayBuffer(cleanPrivate);
            var publicKeyData = base64ToArrayBuffer(cleanPublic);
            return Promise.all([
                window.crypto.subtle.importKey("pkcs8", privateKeyData, { name: "RSA-OAEP", hash: "SHA-256" }, true, ["decrypt"]),
                window.crypto.subtle.importKey("spki", publicKeyData, { name: "RSA-OAEP", hash: "SHA-256" }, true, ["encrypt"])
            ]).then(function(keys) {
                cryptoKeys = { privateKey: keys[0], publicKey: keys[1] };
                return saveKeys();
            }).then(function() { return updateKeyDisplay(); }).then(function() { updateUI(); });
        }
        
        function debounce(func, wait) {
            var timeout;
            return function() {
                var later = function() { clearTimeout(timeout); func(); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        function saveTextState() {
            try {
                if (!messageToEncrypt || !messageToDecrypt) return;
                var state = { messageToEncrypt: messageToEncrypt.value, messageToDecrypt: messageToDecrypt.value };
                var str = JSON.stringify(state);
                if (str.length > 500 * 1024) return;
                localStorage.setItem('rsaTextState', str);
            } catch (e) { }
        }
        function loadTextState() {
            try {
                var raw = localStorage.getItem('rsaTextState');
                if (!raw) return;
                var state = JSON.parse(raw);
                if (state && messageToEncrypt && messageToDecrypt) {
                    messageToEncrypt.value = state.messageToEncrypt || '';
                    messageToDecrypt.value = state.messageToDecrypt || '';
                }
            } catch (e) { }
        }
        var PLACEHOLDER_TEXTS = ['–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', '–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'];
        function updateCopyButtonsState() {
            var list = document.querySelectorAll ? document.querySelectorAll('.copy-btn') : [];
            for (var i = 0; i < list.length; i++) {
                var btn = list[i];
                var targetId = btn.getAttribute('data-target');
                var target = document.getElementById(targetId);
                var wrapper = btn.closest ? btn.closest('.result-wrapper, .key-display-wrapper') : null;
                if (!target || !wrapper) continue;
                var text = (target.textContent || '').trim();
                var hasData = text.length > 0 && PLACEHOLDER_TEXTS.indexOf(text) === -1;
                if (hasData) wrapper.classList.add('has-data'); else wrapper.classList.remove('has-data');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function updateUI() {
            var hasKeys = cryptoKeys !== null;
            if (keyStatusIndicator) keyStatusIndicator.className = 'status-indicator ' + (hasKeys ? 'status-ready' : 'status-not-ready');
            if (keyStatusText) {
                keyStatusText.textContent = hasKeys ? '–ö–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é' : '–ö–ª—é—á–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                keyStatusText.style.color = hasKeys ? '#27ae60' : '#e74c3c';
            }
            if (encryptBtn) { encryptBtn.disabled = !hasKeys; encryptBtn.title = hasKeys ? '' : '–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏'; }
            if (decryptBtn) { decryptBtn.disabled = !hasKeys; decryptBtn.title = hasKeys ? '' : '–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏'; }
            if (exportKeysBtn) exportKeysBtn.disabled = !hasKeys;
            updateCopyButtonsState();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            if (type === undefined) type = 'success';
            if (!messageArea) return;
            var messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type;
            messageDiv.textContent = text;
            messageArea.appendChild(messageDiv);
            setTimeout(function() {
                if (messageDiv.parentNode) {
                    messageDiv.style.opacity = '0';
                    messageDiv.style.transition = 'opacity 0.3s';
                    setTimeout(function() {
                        if (messageDiv.parentNode) messageDiv.parentNode.removeChild(messageDiv);
                    }, 300);
                }
            }, 5000);
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö)
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).catch(function() { fallbackCopy(text); });
            } else {
                fallbackCopy(text);
            }
        }
        function fallbackCopy(text) {
            var textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.setAttribute('readonly', '');
            textArea.style.cssText = 'position:fixed;left:0;top:0;width:1px;height:1px;padding:0;border:0;outline:0;opacity:0.01;z-index:9999;';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            textArea.setSelectionRange(0, (text || '').length);
            try {
                document.execCommand('copy');
            } catch (e) {
                console.warn('–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:', e);
            }
            if (textArea.parentNode) textArea.parentNode.removeChild(textArea);
        }
        
        function generateKeys() {
            if (generateKeysBtn && generateKeysBtn.disabled) return;
            if (generateLoader) generateLoader.style.display = 'inline-block';
            if (generateKeysBtn) generateKeysBtn.disabled = true;
            window.crypto.subtle.generateKey(
                { name: "RSA-OAEP", modulusLength: 2048, publicExponent: new Uint8Array([0x01, 0x00, 0x01]), hash: "SHA-256" },
                true,
                ["encrypt", "decrypt"]
            ).then(function(keyPair) {
                cryptoKeys = keyPair;
                return saveKeys();
            }).then(function() { return updateKeyDisplay(); }).then(function() {
                updateUI();
                showMessage('‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            }).catch(function(error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π: ' + (error && error.message ? error.message : error), 'error');
            }).then(function() {
                if (generateLoader) generateLoader.style.display = 'none';
                if (generateKeysBtn) generateKeysBtn.disabled = false;
            });
        }
        function saveKeys() {
            if (!cryptoKeys) return Promise.resolve();
            return Promise.all([
                window.crypto.subtle.exportKey("pkcs8", cryptoKeys.privateKey),
                window.crypto.subtle.exportKey("spki", cryptoKeys.publicKey)
            ]).then(function(arr) {
                var privateKeyBase64 = arrayBufferToBase64(arr[0]);
                var publicKeyBase64 = arrayBufferToBase64(arr[1]);
                try { localStorage.setItem('rsaPrivateKey', privateKeyBase64); localStorage.setItem('rsaPublicKey', publicKeyBase64); } catch (e) { }
            }).catch(function(error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–ª—é—á–µ–π: ' + (error && error.message ? error.message : error), 'error');
            });
        }
        function loadFromStorage(silent) {
            if (silent === undefined) silent = false;
            try {
                var privateKeyBase64 = localStorage.getItem('rsaPrivateKey');
                var publicKeyBase64 = localStorage.getItem('rsaPublicKey');
                if (!privateKeyBase64 || !publicKeyBase64) {
                    if (!silent) showMessage('‚ÑπÔ∏è –ö–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏—Ö.', 'warning');
                    return Promise.resolve();
                }
                return importKeysFromData(privateKeyBase64, publicKeyBase64).then(function() {
                    if (!silent) showMessage('‚úÖ –ö–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞');
                });
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π: ' + (error && error.message ? error.message : error), 'error');
                return Promise.resolve();
            }
        }
        function updateKeyDisplay() {
            if (!cryptoKeys || !privateKeyDisplay || !publicKeyDisplay) return Promise.resolve();
            return Promise.all([
                window.crypto.subtle.exportKey("pkcs8", cryptoKeys.privateKey),
                window.crypto.subtle.exportKey("spki", cryptoKeys.publicKey)
            ]).then(function(arr) {
                privateKeyDisplay.textContent = formatKey(arrayBufferToBase64(arr[0]));
                publicKeyDisplay.textContent = formatKey(arrayBufferToBase64(arr[1]));
            }).catch(function() { });
        }
        function formatKey(keyBase64) {
            if (!keyBase64) return '';
            var matched = keyBase64.match(/.{1,64}/g);
            return matched ? matched.join('\n') : '';
        }
        
        function encryptMessage() {
            if (encryptBtn && encryptBtn.disabled) return;
            if (!cryptoKeys) { showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏', 'error'); return; }
            var message = messageToEncrypt ? messageToEncrypt.value.trim() : '';
            if (!message) { showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', 'error'); if (messageToEncrypt) messageToEncrypt.focus(); return; }
            var MAX_SIZE = 10 * 1024 * 1024;
            var encoder = new TextEncoder();
            var data = encoder.encode(message);
            var messageBytes = data.length;
            if (messageBytes > MAX_SIZE) {
                showMessage('‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (' + (messageBytes / 1024 / 1024).toFixed(1) + ' –ú–ë). –ú–∞–∫—Å–∏–º—É–º: 10 –ú–ë.', 'error');
                if (messageToEncrypt) messageToEncrypt.focus();
                return;
            }
            if (encryptLoader) encryptLoader.style.display = 'inline-block';
            if (encryptBtn) encryptBtn.disabled = true;
            var doEncrypt = messageBytes <= 190
                ? window.crypto.subtle.encrypt({ name: "RSA-OAEP" }, cryptoKeys.publicKey, data).then(function(encrypted) { return arrayBufferToHexString(encrypted); })
                : hybridEncrypt(data);
            doEncrypt.then(function(hexString) {
                if (encryptedResult) encryptedResult.textContent = hexString;
                updateCopyButtonsState();
                if (window.autoCopyEnabled !== false && hexString.length <= 500 * 1024 && messageToDecrypt) { messageToDecrypt.value = hexString; saveTextState(); }
                else if (window.autoCopyEnabled !== false && hexString.length > 500 * 1024) showMessage('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –∞–≤—Ç–æ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å.', 'warning');
                showMessage('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
            }).catch(function(error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏: ' + (error && error.message ? error.message : error), 'error');
            }).then(function() {
                if (encryptLoader) encryptLoader.style.display = 'none';
                if (encryptBtn) encryptBtn.disabled = !cryptoKeys;
            });
        }
        function decryptMessage() {
            if (decryptBtn && decryptBtn.disabled) return;
            if (!cryptoKeys) { showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏', 'error'); return; }
            var encryptedHex = messageToDecrypt ? messageToDecrypt.value.trim() : '';
            if (!encryptedHex) { showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error'); if (messageToDecrypt) messageToDecrypt.focus(); return; }
            var isHybrid = encryptedHex.indexOf('h1') === 0 && encryptedHex.length > 2;
            var dataHex = isHybrid ? encryptedHex.slice(2) : encryptedHex;
            if (!/^[0-9a-fA-F]+$/.test(dataHex)) { showMessage('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ hex-—Å–∏–º–≤–æ–ª—ã (0-9, a-f, A-F)', 'error'); if (messageToDecrypt) messageToDecrypt.focus(); return; }
            if (dataHex.length % 2 !== 0) { showMessage('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –î–ª–∏–Ω–∞ hex-—Å—Ç—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á—ë—Ç–Ω–æ–π', 'error'); if (messageToDecrypt) messageToDecrypt.focus(); return; }
            if (decryptLoader) decryptLoader.style.display = 'inline-block';
            if (decryptBtn) decryptBtn.disabled = true;
            var doDecrypt = isHybrid ? hybridDecrypt(dataHex) : window.crypto.subtle.decrypt({ name: "RSA-OAEP" }, cryptoKeys.privateKey, hexStringToArrayBuffer(dataHex));
            doDecrypt.then(function(decrypted) {
                var decoder = new TextDecoder();
                var decryptedMessage = decoder.decode(decrypted);
                if (decryptedResult) decryptedResult.textContent = decryptedMessage;
                updateCopyButtonsState();
                showMessage('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
            }).catch(function(error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏: ' + (error && error.message ? error.message : error), 'error');
            }).then(function() {
                if (decryptLoader) decryptLoader.style.display = 'none';
                if (decryptBtn) decryptBtn.disabled = !cryptoKeys;
            });
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –∫–ª—é—á–µ–π (–æ–¥–∏–Ω —Ñ–∞–π–ª: –Ω–∞ Android/—Å—Ä–µ–¥—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ‚Äî —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º–∞—è —Å—Å—ã–ª–∫–∞, –±–µ–∑ programmatic click)
        var exportInProgress = false;
        var exportLockUntil = 0;
        function exportKeys() {
            if (!cryptoKeys) {
                showMessage('‚ùå –ù–µ—Ç –∫–ª—é—á–µ–π –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            var now = Date.now();
            if (exportInProgress || now < exportLockUntil) return;
            exportInProgress = true;
            exportLockUntil = now + 2000;
            var privateKeyDataP = window.crypto.subtle.exportKey("pkcs8", cryptoKeys.privateKey);
            var publicKeyDataP = window.crypto.subtle.exportKey("spki", cryptoKeys.publicKey);
            Promise.all([privateKeyDataP, publicKeyDataP]).then(function(arr) {
                var privateKeyBase64 = arrayBufferToBase64(arr[0]);
                var publicKeyBase64 = arrayBufferToBase64(arr[1]);
                var exportData = {
                    privateKey: privateKeyBase64,
                    publicKey: publicKeyBase64,
                    timestamp: new Date().toISOString(),
                    format: 'RSA-OAEP 2048'
                };
                var blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                var url = URL.createObjectURL(blob);
                var fileName = 'rsa-keys-' + new Date().toISOString().split('T')[0] + '.json';
                var isTouchOrMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || /Android|webOS|iPhone|iPad/i.test(navigator.userAgent);
                if (isTouchOrMobile) {
                    var fallbackLink = document.createElement('a');
                    fallbackLink.href = url;
                    fallbackLink.download = fileName;
                    fallbackLink.textContent = 'üì• –°–∫–∞—á–∞—Ç—å –∫–ª—é—á–∏ (–Ω–∞–∂–º–∏—Ç–µ –æ–¥–∏–Ω —Ä–∞–∑)';
                    fallbackLink.className = 'message success';
                    fallbackLink.style.display = 'block';
                    fallbackLink.style.marginTop = '8px';
                    fallbackLink.style.padding = '14px';
                    messageArea.appendChild(fallbackLink);
                    setTimeout(function() {
                        if (fallbackLink.parentNode) fallbackLink.parentNode.removeChild(fallbackLink);
                        URL.revokeObjectURL(url);
                    }, 20000);
                    showMessage('‚úÖ –ù–∞–∂–º–∏—Ç–µ —Å—Å—ã–ª–∫—É –≤—ã—à–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª');
                } else {
                    var a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    setTimeout(function() { URL.revokeObjectURL(url); }, 200);
                    showMessage('‚úÖ –ö–ª—é—á–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª');
                }
            }).catch(function(error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∫–ª—é—á–µ–π: ' + (error.message || error), 'error');
            }).then(function() {
                exportInProgress = false;
            });
        }
        
        function clearKeys() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
            cryptoKeys = null;
            try { localStorage.removeItem('rsaPrivateKey'); localStorage.removeItem('rsaPublicKey'); localStorage.removeItem('rsaTextState'); } catch (e) { }
            if (privateKeyDisplay) privateKeyDisplay.textContent = '–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
            if (publicKeyDisplay) publicKeyDisplay.textContent = '–ö–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
            if (messageToEncrypt) messageToEncrypt.value = '';
            if (messageToDecrypt) messageToDecrypt.value = '';
            if (encryptedResult) encryptedResult.textContent = '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è';
            if (decryptedResult) decryptedResult.textContent = '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è';
            if (fileInputContainer) fileInputContainer.style.display = 'none';
            hidePasteKeysInput();
            updateUI();
            updateCopyButtonsState();
            showMessage('–í—Å–µ –∫–ª—é—á–∏ –∏ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
        }
        
        function arrayBufferToBase64(buffer) {
            var bytes = new Uint8Array(buffer);
            var binary = '';
            for (var i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
            return btoa(binary);
        }
        function base64ToArrayBuffer(base64) {
            try {
                var binary = atob(base64);
                var bytes = new Uint8Array(binary.length);
                for (var i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
                return bytes.buffer;
            } catch (e) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Base64. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é.');
            }
        }
        function arrayBufferToHexString(buffer) {
            var bytes = new Uint8Array(buffer);
            var hex = '';
            for (var i = 0; i < bytes.length; i++) {
                var h = bytes[i].toString(16);
                if (h.length < 2) h = '0' + h;
                hex += h;
            }
            return hex;
        }
        function hexStringToArrayBuffer(hexString) {
            var bytes = new Uint8Array(hexString.length / 2);
            for (var i = 0; i < hexString.length; i += 2) bytes[i / 2] = parseInt(hexString.slice(i, i + 2), 16);
            return bytes.buffer;
        }
        function hybridEncrypt(data) {
            return window.crypto.subtle.generateKey({ name: "AES-GCM", length: 256 }, true, ["encrypt"]).then(function(aesKey) {
                var iv = crypto.getRandomValues(new Uint8Array(12));
                return window.crypto.subtle.encrypt({ name: "AES-GCM", iv: iv, tagLength: 128 }, aesKey, data).then(function(encrypted) {
                    return window.crypto.subtle.exportKey("raw", aesKey).then(function(aesKeyRaw) {
                        return window.crypto.subtle.encrypt({ name: "RSA-OAEP" }, cryptoKeys.publicKey, aesKeyRaw).then(function(encryptedAesKey) {
                            return "h1" + arrayBufferToHexString(encryptedAesKey) + arrayBufferToHexString(iv) + arrayBufferToHexString(encrypted);
                        });
                    });
                });
            });
        }
        function hybridDecrypt(hexData) {
            var rsaEncryptedLen = 512;
            var ivLen = 24;
            if (hexData.length < rsaEncryptedLen + ivLen + 32) return Promise.reject(new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö'));
            var rsaEncryptedHex = hexData.slice(0, rsaEncryptedLen);
            var ivHex = hexData.slice(rsaEncryptedLen, rsaEncryptedLen + ivLen);
            var cipherAndTagHex = hexData.slice(rsaEncryptedLen + ivLen);
            var aesKeyEncrypted = hexStringToArrayBuffer(rsaEncryptedHex);
            return window.crypto.subtle.decrypt({ name: "RSA-OAEP" }, cryptoKeys.privateKey, aesKeyEncrypted).then(function(aesKeyRaw) {
                return window.crypto.subtle.importKey("raw", aesKeyRaw, { name: "AES-GCM" }, false, ["decrypt"]);
            }).then(function(aesKey) {
                var iv = hexStringToArrayBuffer(ivHex);
                var cipherAndTag = hexStringToArrayBuffer(cipherAndTagHex);
                return window.crypto.subtle.decrypt({ name: "AES-GCM", iv: iv, tagLength: 128 }, aesKey, cipherAndTag);
            });
        }
        
        try {
            if (document.body) init();
            else if (document.addEventListener) document.addEventListener('DOMContentLoaded', init);
            else window.onload = init;
        } catch (e) {
            try { document.body.insertAdjacentHTML('afterbegin', '<div class="message error" style="margin:20px;">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Chrome, Edge): –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ —Ñ–∞–π–ª—É.</div>'); } catch (err) { }
        }
    </script>
</body>
</html>